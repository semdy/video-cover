!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VideoCover=t():e.VideoCover=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,i)=>{for(var o in i)e.o(i,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:i[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.r(t),e.d(t,{default:()=>n});const n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var o=t.url,n=t.file,r=t.currentTime,a=void 0===r?1:r,s=t.quality,d=t.imgWidth,c=t.imageType,l=t.isCheckImageColor;o||n||console.warn("视频链接不能为空"),this.url=o,this.file=n,this.video=null,this.videoWidth=0,this.imageType=c||"image/jpeg",this.quality=s?s>.2?s:.2:.95,this.imgWidth=d||800,this.currentTime=a<1?1:a,this.isCheckImageColor=l,this.duration=0}var t,n,r;return t=e,r=[{key:"base64ToBlob",value:function(e){if(e){for(var t=e.split(";base64,"),i=t[0].split(":")[1],o=window.atob(t[1]),n=o.length,r=new Uint8Array(n),a=0;a<n;++a)r[a]=o.charCodeAt(a);return new Blob([r],{type:i})}console.warn("base64不能为空")}},{key:"downloadFile",value:function(e){var t=Date.now();if(e){var i=document.createElement("a"),o=this.base64ToBlob(e),n=URL.createObjectURL(o);document.createEvent("HTMLEvents").initEvent("click",!0,!0),i.download=t,i.href=n,i.click(),window.URL.revokeObjectURL(n),i=null,n=null}else console.warn("base64不能为空")}}],(n=[{key:"getVideoCover",value:function(e){var t=this,i=this.video||document.createElement("video"),o=t.currentTime;t.file?i.src=URL.createObjectURL(t.file):i.src=t.url,i.style.cssText="position: fixed; top: -100%; width: 400px; visibility: hidden;",i.controls="controls",i.crossOrigin="Anonymous",i.muted=!0,i.addEventListener("loadedmetadata",(function(){i.currentTime=o}),!1),i.addEventListener("timeupdate",(function(){t.setVideoInfo(),t.currentTime<=t.duration?t.generateCanvas(e):t.nextTime()})),this.video=i}},{key:"setVideoInfo",value:function(){var e=this.video;this.videoWidth=e.videoWidth||this.videoWidth,this.videoHeight=e.videoHeight||this.videoHeight,this.duration=Math.floor(e.duration||0)}},{key:"jumpTime",value:function(e){var t=this.duration;e=e>t?t:e,this.currentTime=e,this.video.currentTime=e}},{key:"nextTime",value:function(){var e=this.duration,t=this.currentTime;this.currentTime!==e&&(t++,this.jumpTime(t))}},{key:"generateCanvas",value:function(e){var t=this.canvas||document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),o=this.imgWidth,n=this.isCheckImageColor,r=this.videoWidth,a=this.videoHeight;if(this.canvas||(o&&(a=o/(r/a),r=o),t.width=r,t.height=a),i.drawImage(this.video,0,0,t.width,t.height),!n||this.checkImage(i,r,a)){var s=t.toDataURL(this.imageType,this.quality);e&&e(s)}else this.nextTime()}},{key:"checkImage",value:function(e,t,i){for(var o=e.getImageData(0,0,t,i).data,n={},r=0,a=0,s=o.length;a<s;a+=4){var d=[].slice.call(o,a,a+4).join("");if(n[d]||(n[d]=1,r++),r>100)return!0}return!1}}])&&o(t.prototype,n),r&&o(t,r),e}();return t})()}));