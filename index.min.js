!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VideoCover=t():e.VideoCover=t()}(self,(function(){return function(){"use strict";var e={};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var n=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e);var n=i.url,o=i.currentTime,r=void 0===o?1:o,a=i.quality,s=i.imgWidth,c=i.imageType,u=i.genBlob,l=i.isCheckImageColor,d=i.onNextFrame;n||console.warn("视频链接不能为空"),this.url=n,this.video=null,this.videoWidth=0,this.imageType=c||"image/jpeg",this.quality=a?a>.2?a:.2:.95,this.imgWidth=s||800,this.genBlob=u,this.currentTime=r<1?1:r,this.isCheckImageColor=l,this.duration=0,this.onNextFrame=d||function(){}}var n,o,r;return n=e,r=[{key:"base64ToBlob",value:function(e){if(e){for(var t=e.split(";base64,"),i=t[0].split(":")[1],n=window.atob(t[1]),o=n.length,r=new Uint8Array(o),a=0;a<o;++a)r[a]=n.charCodeAt(a);return new Blob([r],{type:i})}console.warn("base64不能为空")}},{key:"downloadFile",value:function(e){var t=Date.now();if(e){var i=document.createElement("a"),n=this.base64ToBlob(e),o=URL.createObjectURL(n);document.createEvent("HTMLEvents").initEvent("click",!0,!0),i.download=t,i.href=o,i.click(),window.URL.revokeObjectURL(o),i=null,o=null}else console.warn("base64不能为空")}}],(o=[{key:"getVideoCover",value:function(){var e=this;return new Promise((function(t,i){try{var n=e.video||document.createElement("video"),o=e.currentTime;e.url instanceof Blob?n.src=URL.createObjectURL(e.url):n.src=e.url,n.controls="controls",n.crossOrigin="Anonymous",n.muted=!0,n.addEventListener("loadedmetadata",(function(){n.currentTime=o}),!1),n.addEventListener("timeupdate",(function(){e.setVideoInfo(),e.currentTime<=e.duration?e.generateCanvas((function(i){t(i),e.onNextFrame(i)})):e.nextTime()})),n.addEventListener("error",(function(){i(n.error)}),!1),n.load(),e.video||(e.video=n)}catch(e){i(e)}}))}},{key:"setVideoInfo",value:function(){var e=this.video;this.videoWidth=e.videoWidth||this.videoWidth,this.videoHeight=e.videoHeight||this.videoHeight,this.duration=Math.floor(e.duration||0)}},{key:"jumpTime",value:function(e){var t=this.duration;e=e>t?t:e,this.currentTime=e,this.video.currentTime=e}},{key:"nextTime",value:function(){var e=this.duration,t=this.currentTime;this.currentTime!==e&&(t++,this.jumpTime(t))}},{key:"generateCanvas",value:function(e){var t=this.canvas||document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),n=this.imgWidth,o=this.isCheckImageColor,r=this.videoWidth,a=this.videoHeight;if(this.canvas||(n&&(a=n/(r/a),r=n),t.width=r,t.height=a,this.canvas=t),i.clearRect(0,0,t.width,t.height),i.drawImage(this.video,0,0,t.width,t.height),!o||this.checkImage(i,r,a))if(this.genBlob)t.toBlob((function(t){e(t)}),this.imageType,this.quality);else{var s=t.toDataURL(this.imageType,this.quality);e(s)}else this.nextTime()}},{key:"checkImage",value:function(e,t,i){for(var n=e.getImageData(0,0,t,i).data,o={},r=0,a=0,s=n.length;a<s;a+=4){var c=[].slice.call(n,a,a+4).join("");if(o[c]||(o[c]=1,r++),r>100)return!0}return!1}}])&&i(n.prototype,o),r&&i(n,r),e}();return e.default=n,e}()}));