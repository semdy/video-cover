!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VideoCover=t():e.VideoCover=t()}(self,(function(){return function(){"use strict";var e={};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var o=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e);var o=i.url,n=i.currentTime,a=void 0===n?1:n,r=i.quality,d=i.imgWidth,s=i.imageType,u=i.isCheckImageColor;o||console.warn("视频链接不能为空"),this.url=o,this.video=null,this.videoWidth=0,this.imageType=s||"image/jpeg",this.quality=r?r>.2?r:.2:.95,this.imgWidth=d||800,this.currentTime=a<1?1:a,this.isCheckImageColor=u,this.duration=0}var o,n,a;return o=e,a=[{key:"base64ToBlob",value:function(e){if(e){for(var t=e.split(";base64,"),i=t[0].split(":")[1],o=window.atob(t[1]),n=o.length,a=new Uint8Array(n),r=0;r<n;++r)a[r]=o.charCodeAt(r);return new Blob([a],{type:i})}console.warn("base64不能为空")}},{key:"downloadFile",value:function(e){var t=Date.now();if(e){var i=document.createElement("a"),o=this.base64ToBlob(e),n=URL.createObjectURL(o);document.createEvent("HTMLEvents").initEvent("click",!0,!0),i.download=t,i.href=n,i.click(),window.URL.revokeObjectURL(n),i=null,n=null}else console.warn("base64不能为空")}}],(n=[{key:"getVideoCover",value:function(e){var t=this;t.video=this.video||document.createElement("video");var i=t.currentTime;t.url instanceof Blob?t.video.src=URL.createObjectURL(t.url):t.video.src=t.url,t.video.style.cssText="position: fixed; top: -100%; width: 400px; visibility: hidden;",t.video.controls="controls",t.video.crossOrigin="Anonymous",t.video.muted=!0,t.video.addEventListener("loadedmetadata",(function(){t.video.currentTime=i}),!1),t.video.addEventListener("timeupdate",(function(){t.setVideoInfo(),t.currentTime<=t.duration?t.generateCanvas(e):t.nextTime()}))}},{key:"setVideoInfo",value:function(){var e=this.video;this.videoWidth=e.videoWidth||this.videoWidth,this.videoHeight=e.videoHeight||this.videoHeight,this.duration=Math.floor(e.duration||0)}},{key:"jumpTime",value:function(e){var t=this.duration;e=e>t?t:e,this.currentTime=e,this.video.currentTime=e}},{key:"nextTime",value:function(){var e=this.duration,t=this.currentTime;this.currentTime!==e&&(t++,this.jumpTime(t))}},{key:"generateCanvas",value:function(e){var t=this.canvas||document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),o=this.imgWidth,n=this.isCheckImageColor,a=this.videoWidth,r=this.videoHeight;if(this.canvas||(o&&(r=o/(a/r),a=o),t.width=a,t.height=r),i.drawImage(this.video,0,0,t.width,t.height),!n||this.checkImage(i,a,r)){var d=t.toDataURL(this.imageType,this.quality);e&&e(d)}else this.nextTime()}},{key:"checkImage",value:function(e,t,i){for(var o=e.getImageData(0,0,t,i).data,n={},a=0,r=0,d=o.length;r<d;r+=4){var s=[].slice.call(o,r,r+4).join("");if(n[s]||(n[s]=1,a++),a>100)return!0}return!1}}])&&i(o.prototype,n),a&&i(o,a),e}();return e.default=o,e}()}));