!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VideoCover=t():e.VideoCover=t()}(self,(function(){return function(){"use strict";var e={};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var n=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e);var n=i.url,o=i.file,a=i.currentTime,r=void 0===a?1:a,s=i.quality,d=i.imgWidth,u=i.imageType,c=i.isCheckImageColor;n||o||console.warn("视频链接不能为空"),this.url=n,this.file=o,this.video=null,this.videoWidth=0,this.imageType=u||"image/jpeg",this.quality=s?s>.2?s:.2:.95,this.imgWidth=d||800,this.currentTime=r<1?1:r,this.isCheckImageColor=c,this.duration=0}var n,o,a;return n=e,a=[{key:"base64ToBlob",value:function(e){if(e){for(var t=e.split(";base64,"),i=t[0].split(":")[1],n=window.atob(t[1]),o=n.length,a=new Uint8Array(o),r=0;r<o;++r)a[r]=n.charCodeAt(r);return new Blob([a],{type:i})}console.warn("base64不能为空")}},{key:"downloadFile",value:function(e){var t=Date.now();if(e){var i=document.createElement("a"),n=this.base64ToBlob(e),o=URL.createObjectURL(n);document.createEvent("HTMLEvents").initEvent("click",!0,!0),i.download=t,i.href=o,i.click(),window.URL.revokeObjectURL(o),i=null,o=null}else console.warn("base64不能为空")}}],(o=[{key:"getVideoCover",value:function(e){var t=this,i=this.video||document.createElement("video"),n=t.currentTime;t.file?i.src=URL.createObjectURL(t.file):i.src=t.url,i.style.cssText="position: fixed; top: -100%; width: 400px; visibility: hidden;",i.controls="controls",i.crossOrigin="Anonymous",i.muted=!0,i.addEventListener("loadedmetadata",(function(){i.currentTime=n}),!1),i.addEventListener("timeupdate",(function(){t.setVideoInfo(),t.currentTime<=t.duration?t.generateCanvas(e):t.nextTime()})),this.video=i}},{key:"setVideoInfo",value:function(){var e=this.video;this.videoWidth=e.videoWidth||this.videoWidth,this.videoHeight=e.videoHeight||this.videoHeight,this.duration=Math.floor(e.duration||0)}},{key:"jumpTime",value:function(e){var t=this.duration;e=e>t?t:e,this.currentTime=e,this.video.currentTime=e}},{key:"nextTime",value:function(){var e=this.duration,t=this.currentTime;this.currentTime!==e&&(t++,this.jumpTime(t))}},{key:"generateCanvas",value:function(e){var t=this.canvas||document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),n=this.imgWidth,o=this.isCheckImageColor,a=this.videoWidth,r=this.videoHeight;if(this.canvas||(n&&(r=n/(a/r),a=n),t.width=a,t.height=r),i.drawImage(this.video,0,0,t.width,t.height),!o||this.checkImage(i,a,r)){var s=t.toDataURL(this.imageType,this.quality);e&&e(s)}else this.nextTime()}},{key:"checkImage",value:function(e,t,i){for(var n=e.getImageData(0,0,t,i).data,o={},a=0,r=0,s=n.length;r<s;r+=4){var d=[].slice.call(n,r,r+4).join("");if(o[d]||(o[d]=1,a++),a>100)return!0}return!1}}])&&i(n.prototype,o),a&&i(n,a),e}();return e.default=n,e}()}));